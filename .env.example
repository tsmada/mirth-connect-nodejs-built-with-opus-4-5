# =============================================================================
# Mirth Connect Node.js Runtime — Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment.
#   cp .env.example .env
#
# Lines starting with # are comments. Uncomment and set values as needed.
# Variables with defaults shown in (parentheses) are optional.
# =============================================================================

# -----------------------------------------------------------------------------
# Operational Mode
# -----------------------------------------------------------------------------
# The ONLY difference between Java Mirth and Node.js Mirth.
#   takeover   — Connect to existing Java Mirth database (zero migration)
#   standalone — Create fresh schema from scratch
#   auto       — Detect: existing schema → takeover, empty DB → standalone
MIRTH_MODE=auto

# -----------------------------------------------------------------------------
# Server
# -----------------------------------------------------------------------------
PORT=8081
NODE_ENV=development
# HTTPS_PORT=8443            # (unused — TLS terminated at reverse proxy)

# -----------------------------------------------------------------------------
# Database
# -----------------------------------------------------------------------------
# Point to existing Java Mirth MySQL for takeover mode, or a fresh DB for standalone.
DB_HOST=localhost
DB_PORT=3306
DB_USER=mirth
DB_PASSWORD=mirth
DB_NAME=mirthdb

# Pool sizing — auto-scales at startup based on channel count if DB_POOL_SIZE is omitted.
# Formula: max(10, ceil(enabledChannels / 5)), capped by DB_POOL_MAX.
# DB_POOL_SIZE=               # (auto) Explicit override disables auto-scaling
# DB_POOL_MAX=100             # (100 standalone / 50 takeover) Upper bound for auto-scale
# DB_QUEUE_LIMIT=200          # Max queued connection requests
# DB_ACQUIRE_TIMEOUT=30000    # Max ms to wait for a free connection
# DB_CONNECT_TIMEOUT=10000    # Connection establishment timeout (ms)
# DB_DEADLOCK_RETRIES=3       # Auto-retry on MySQL deadlock (exponential backoff)
# DB_TIMEZONE=+00:00          # Timezone for date handling

# -----------------------------------------------------------------------------
# Startup Concurrency
# -----------------------------------------------------------------------------
# Max channels starting simultaneously during server boot.
# Default: min(10, floor(poolSize / 3))
# MIRTH_STARTUP_CONCURRENCY=10

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO
# MIRTH_DEBUG_COMPONENTS=     # Comma-separated: http-connector,engine,tcp-connector
# LOG_FORMAT=text             # text (human-readable) or json (structured)
# LOG_FILE=                   # Optional file path for file transport
# LOG_TIMESTAMP_FORMAT=mirth  # mirth (Java-style) or iso (ISO 8601)

# -----------------------------------------------------------------------------
# Security & Authorization
# -----------------------------------------------------------------------------
# MIRTH_AUTH_MODE=role-based  # role-based (enforced) or permissive (allow-all)
# MIRTH_API_RATE_LIMIT=100   # Requests per minute per IP
# CORS_ORIGINS=*              # Comma-separated allowed origins (restrict in production)
# MIRTH_ALLOW_DEFAULT_CREDENTIALS=false  # Set true to allow mirth/mirth in production

# -----------------------------------------------------------------------------
# Script Execution
# -----------------------------------------------------------------------------
# MIRTH_SCRIPT_TIMEOUT=30000       # CPU timeout for user scripts (ms)
# MIRTH_SCRIPT_WALL_TIMEOUT=60000  # Wall-clock warning threshold (ms)

# -----------------------------------------------------------------------------
# Shadow Mode (safe Java → Node.js takeover)
# -----------------------------------------------------------------------------
# MIRTH_SHADOW_MODE=false     # true = deploy channels read-only, promote one-by-one

# -----------------------------------------------------------------------------
# Horizontal Scaling (Cluster)
# -----------------------------------------------------------------------------
# MIRTH_SERVER_ID=             # (auto UUID) Unique instance identifier
# MIRTH_CLUSTER_ENABLED=false
# MIRTH_CLUSTER_SECRET=        # Inter-instance API auth secret
# MIRTH_CLUSTER_REDIS_URL=     # Redis URL for maps + events (optional)
# MIRTH_CLUSTER_HEARTBEAT_INTERVAL=10000
# MIRTH_CLUSTER_HEARTBEAT_TIMEOUT=30000
# MIRTH_CLUSTER_SEQUENCE_BLOCK=100
# MIRTH_CLUSTER_POLLING_MODE=exclusive  # exclusive (one poller per channel) or all
# MIRTH_CLUSTER_LEASE_TTL=30000
# MIRTH_CLUSTER_QUORUM_ENABLED=false
# MIRTH_CLUSTER_DEAD_NODE_CLEANUP=true
# MIRTH_CLUSTER_MAX_HEARTBEAT_FAILURES=3

# Takeover mode polling — comma-separated channel IDs/names to enable polling
# (by default, polling is blocked in takeover mode to prevent competing with Java Mirth)
# MIRTH_TAKEOVER_POLL_CHANNELS=

# -----------------------------------------------------------------------------
# OpenTelemetry
# -----------------------------------------------------------------------------
# OTEL_SERVICE_NAME=mirth-connect-node
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
# OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
# OTEL_EXPORTER_OTLP_HEADERS=
# OTEL_RESOURCE_ATTRIBUTES=deployment.environment=dev
# OTEL_TRACES_SAMPLER=parentbased_always_on
# OTEL_SDK_DISABLED=false
# MIRTH_OTEL_PROMETHEUS_PORT=  # Set to enable Prometheus scrape (e.g., 9464)

# -----------------------------------------------------------------------------
# Git-Backed Artifact Management
# -----------------------------------------------------------------------------
# MIRTH_ARTIFACT_REPO=         # Path to git repo for artifact sync
# MIRTH_ARTIFACT_ENV=          # Active environment (dev/staging/prod)
# MIRTH_ARTIFACT_AUTO_SYNC=false
# MIRTH_ARTIFACT_REMOTE=origin

# -----------------------------------------------------------------------------
# Secrets Management
# -----------------------------------------------------------------------------
# MIRTH_SECRETS_PROVIDERS=env             # Comma-separated: env,file,aws,gcp,azure,vault
# MIRTH_SECRETS_CACHE_TTL=300             # Cache TTL in seconds
# MIRTH_SECRETS_FILE_PATH=/run/secrets    # Path for file-based secrets
# MIRTH_SECRETS_ENCRYPT_CACHE=false       # Encrypt secrets in memory
# MIRTH_ENCRYPTION_KEY=                   # AES key for cache encryption + DB field encryption
# MIRTH_CONFIG_FILE=                      # Config file path for secrets

# AWS Secrets Manager
# MIRTH_SECRETS_AWS_REGION=
# MIRTH_SECRETS_AWS_PREFIX=mirth/

# GCP Secret Manager
# MIRTH_SECRETS_GCP_PROJECT=

# Azure Key Vault
# MIRTH_SECRETS_AZURE_VAULT_URL=

# HashiCorp Vault
# MIRTH_SECRETS_VAULT_ADDR=
# MIRTH_SECRETS_VAULT_TOKEN=
# MIRTH_SECRETS_VAULT_PATH=secret/data/mirth
# MIRTH_SECRETS_VAULT_AUTH=token          # token, approle, or kubernetes
# MIRTH_SECRETS_VAULT_ROLE_ID=
# MIRTH_SECRETS_VAULT_SECRET_ID=
# MIRTH_SECRETS_VAULT_K8S_ROLE=

# -----------------------------------------------------------------------------
# WebSocket
# -----------------------------------------------------------------------------
# MIRTH_WS_MAX_CLIENTS=100    # Max concurrent WebSocket connections

# -----------------------------------------------------------------------------
# TLS (for cookie secure flag only — actual TLS at reverse proxy)
# -----------------------------------------------------------------------------
# TLS_ENABLED=false
